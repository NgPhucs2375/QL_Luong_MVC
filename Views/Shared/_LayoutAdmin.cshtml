<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Quản trị hệ thống</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="~/Content/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <link href="~/Content/css/sb-admin-2.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        :root {
            /* MÀU RƯỢU VANG & JAZZ */
            --wine-primary: #722F37; /* Màu rượu vang đỏ thẫm */
            --wine-dark: #4A192C; /* Màu vang tối */
            --jazz-gold: #D4AF37; /* Màu vàng kim loại (Kèn Saxophone) */
            --jazz-gold-hover: #AA8C2C;
            --night-black: #1A1A1A; /* Màu nền tối */
            --piano-white: #F9F9F9; /* Màu phím đàn trắng ngà */
            --text-main: #2C2C2C;
            /* CẤU TRÚC */
            --sidebar-width: 250px;
            --card-radius: 12px;
            --glass-effect: rgba(255, 255, 255, 0.9); /* Kính mờ nhưng sang trọng */
        }

        body {
            font-family: 'Playfair Display', serif; /* Font tiêu đề sang trọng */
            background-color: #F4F1EA; /* Màu giấy cũ */
            color: var(--text-main);
        }

        /* Sidebar đổi màu */
        .bg-slate-theme {
            background: linear-gradient(180deg, var(--wine-dark) 0%, var(--wine-primary) 100%) !important;
            border-right: 1px solid var(--jazz-gold);
        }

        /* Các nút bấm (Buttons) */
        .btn-primary, .btn-add-accent {
            background-color: var(--wine-primary) !important;
            border-color: var(--wine-primary) !important;
            color: var(--jazz-gold) !important; /* Chữ vàng trên nền đỏ */
            font-family: 'Inter', sans-serif; /* Font nội dung hiện đại */
            font-weight: 600;
            letter-spacing: 1px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Hiệu ứng nảy */
        }

            .btn-primary:hover {
                background-color: var(--wine-dark) !important;
                box-shadow: 0 5px 15px rgba(114, 47, 55, 0.4);
                transform: translateY(-2px);
            }

        /* Card - Hiệu ứng nổi và viền vàng mỏng */
        .card, .theme-card {
            background: var(--piano-white) !important;
            border: 1px solid rgba(212, 175, 55, 0.2); /* Viền vàng mờ */
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        /* Tiêu đề trang */
        h1, h2, h3, .sidebar-brand-text {
            font-family: 'Playfair Display', serif;
            color: var(--wine-primary) !important;
        }
    </style>
    @RenderSection("Styles", required: false)
</head>

<body id="page-top">

    @helper IsActive(string controller, string action)
    {
        var routeData = ViewContext.RouteData;
        var currentAction = routeData.Values["action"].ToString();
        var currentController = routeData.Values["controller"].ToString();

        if (string.Equals(currentAction, action, StringComparison.OrdinalIgnoreCase) &&
            string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase))
        {
            @Html.Raw("active")
        }
    }

    <div id="wrapper">
        <ul class="navbar-nav bg-slate-theme sidebar sidebar-dark accordion" id="accordionSidebar">

            <li class="sidebar-brand d-flex align-items-center justify-content-center py-4" href="@Url.Action("Index", "Home")">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-wine-glass-alt fa-2x text-warning"></i>
                </div>
                <div class="sidebar-brand-text mx-3" style="font-family: 'Playfair Display', serif;">HRM <span class="text-warning">JAZZ</span></div>
            </li>

            <li class="sidebar-divider my-0">

            <li class="nav-item @IsActive("Home", "Index")">
                <a class="nav-link" href="@Url.Action("Index", "Home")">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Tổng quan (Dashboard)</span>
                </a>
            </li>

            <li class="sidebar-divider">
            <li class="sidebar-heading text-warning">Nghiệp vụ Chính</li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseHR">
                    <i class="fas fa-fw fa-users"></i>
                    <span>Quản lý Hồ sơ</span>
                </a>
                <div id="collapseHR" class="collapse" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Nhân sự:</h6>
                        <a class="collapse-item" href="@Url.Action("DanhSachNV", "NhanVien")">Danh sách nhân viên</a>
                        <a class="collapse-item" href="@Url.Action("ThemNV", "NhanVien")">Thêm nhân viên mới</a>
                        <div class="collapse-divider"></div>
                        <h6 class="collapse-header">Pháp lý:</h6>
                        <a class="collapse-item" href="@Url.Action("Index", "HopDong")">Hợp đồng lao động</a>
                    </div>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTime">
                    <i class="fas fa-fw fa-clock"></i>
                    <span>Quản lý Thời gian</span>
                </a>
                <div id="collapseTime" class="collapse" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="@Url.Action("Index", "ChamCong")">Bảng chấm công ngày</a>
                        <a class="collapse-item" href="@Url.Action("Create", "ChamCong")">Chấm công mới</a>
                        <a class="collapse-item" href="@Url.Action("XemGioTangCa", "ChamCong")">Tổng tăng ca</a>
                    </div>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSalary">
                    <i class="fas fa-fw fa-money-check-alt"></i>
                    <span>Lương & Phúc lợi</span>
                </a>
                <div id="collapseSalary" class="collapse" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Nghiệp vụ lương:</h6>
                        <a class="collapse-item font-weight-bold text-primary" href="@Url.Action("TinhLuong", "BangLuong")">▶ Tính lương tháng</a>
                        <a class="collapse-item" href="@Url.Action("BaoCao", "BangLuong")">Báo cáo & Phiếu lương</a>
                        <div class="collapse-divider"></div>
                        <h6 class="collapse-header">Cấu hình:</h6>
                        <a class="collapse-item" href="@Url.Action("Index", "LuongCoban")">Thang bảng lương</a>
                        <a class="collapse-item" href="@Url.Action("Index", "PhuCap")">Định mức phụ cấp</a>
                    </div>
                </div>
            </li>

            <li class="sidebar-divider">
            <li class="sidebar-heading text-warning">Hệ thống</li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSys">
                    <i class="fas fa-fw fa-cogs"></i>
                    <span>Cấu hình Hệ thống</span>
                </a>
                <div id="collapseSys" class="collapse" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="@Url.Action("QuanLyTaiKhoan", "Admin")">Phân quyền tài khoản</a>
                        <a class="collapse-item" href="@Url.Action("DanhSachPB", "NhanVien")">Danh mục Phòng ban</a>
                    </div>
                </div>
            </li>

            <li class="text-center d-none d-md-inline mt-4">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </li>
        </ul>        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">

                <nav class="navbar navbar-expand navbar-light topbar mb-4 static-top glass-nav">

                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <div class="d-none d-sm-flex align-items-center">
                        <h1 class="h5 mb-0 text-gray-800 font-weight-bold animate__animated animate__fadeInDown">@ViewBag.Title</h1>
                        <span class="ml-3 px-2 py-1 bg-gray-200 text-xs rounded text-gray-600 font-weight-bold">
                            <i class="far fa-clock mr-1"></i> @DateTime.Now.ToString("dd/MM/yyyy")
                        </span>
                    </div>

                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown">
                                <i class="fas fa-bell fa-fw text-primary"></i>
                                <span class="badge badge-danger badge-counter">3+</span>
                            </a>
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in">
                                <h6 class="dropdown-header bg-primary border-0">Trung tâm thông báo</h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3"><div class="icon-circle bg-warning"><i class="fas fa-exclamation-triangle text-white"></i></div></div>
                                    <div><div class="small text-gray-500">Hôm nay</div><span class="font-weight-bold">3 Hợp đồng sắp hết hạn!</span></div>
                                </a>
                            </div>
                        </li>

                        <li class="topbar-divider d-none d-sm-block"></li>

                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small font-weight-bold">@Session["TenDangNhap"]</span>
                                <img class="img-profile rounded-circle" src="~/Content/img/default-avatar.png">
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> Cài đặt
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Đăng xuất
                                </a>
                            </div>
                        </li>
                    </ul>
                </nav>
                <div class="container-fluid fade-in-content">
                    @RenderBody()
                </div>
            </div>

            <footer class="sticky-footer bg-white mt-4">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>HRM System &copy; 2025 - Developed by <strong>You</strong></span>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Xác nhận đăng xuất?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Chọn "Đăng xuất" bên dưới nếu bạn muốn kết thúc phiên làm việc hiện tại.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Hủy</button>
                    <a class="btn btn-primary" href="@Url.Action("Logout", "Login")">Đăng xuất</a>
                </div>
            </div>
        </div>
    </div>

    <script src="~/Content/vendor/jquery/jquery.min.js"></script>
    <script src="~/Content/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/Content/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="~/Scripts/js/sb-admin-2.min.js"></script>
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
    $(document).ready(function () {
        // --- A. Kích hoạt DataTables cho tất cả bảng ---
        $('.table').DataTable({
            "language": {
                "sProcessing":   "Đang xử lý...",
                "sLengthMenu":   "Xem _MENU_ mục",
                "sZeroRecords":  "Không tìm thấy dòng nào phù hợp",
                "sInfo":         "Đang xem _START_ đến _END_ trong tổng số _TOTAL_ mục",
                "sSearch":       "Tìm kiếm:",
                "oPaginate": {
                    "sFirst":    "Đầu",
                    "sLast":     "Cuối",
                    "sNext":     "Sau",
                    "sPrevious": "Trước"
                }
            },
            "pageLength": 10,
            "lengthChange": false // Tắt chọn số dòng nếu muốn giao diện gọn
        });

        // --- B. Hiển thị thông báo SweetAlert2 tự động ---
        // Lấy dữ liệu từ TempData hoặc ViewBag server-side đẩy xuống
        var msgSuccess = '@TempData["SuccessMessage"]' || '@TempData["ThongBao"]';
        var msgError = '@ViewBag.ErrorMessage' || '@TempData["Error"]';

        if (msgSuccess && msgSuccess.trim() !== "") {
            Swal.fire({
                title: 'Thành công!',
                text: msgSuccess,
                icon: 'success',
                confirmButtonColor: '#722F37', // Màu rượu vang
                background: '#fff url(/Content/img/texture-paper.png)', // Texture giấy (nếu có)
                backdrop: `rgba(114,47,55,0.1)`
            });
        }

        if (msgError && msgError.trim() !== "") {
            Swal.fire({
                icon: 'error',
                title: 'Có lỗi xảy ra...',
                text: msgError,
                confirmButtonColor: '#722F37'
            });
        }

        // --- C. Hiệu ứng xác nhận xóa (Thay thế confirm mặc định) ---
        // Gán class .btn-delete-confirm cho các nút xóa
        $('.btn-delete-confirm').on('click', function(e) {
            e.preventDefault();
            var form = $(this).closest('form'); // Hoặc lấy link href
            var link = $(this).attr('href');

            Swal.fire({
                title: 'Bạn chắc chắn chứ?',
                text: "Dữ liệu này sẽ không thể khôi phục!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Vâng, xóa nó!',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    if(link) window.location.href = link;
                    else form.submit();
                }
            });
        });
    });
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>