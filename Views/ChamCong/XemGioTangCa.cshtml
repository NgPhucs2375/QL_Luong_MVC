@using QL_Luong_MVC.Models
@{
    ViewBag.Title = "Xem giờ tăng ca";
    int thang = ViewBag.Thang ?? DateTime.Now.Month;
    int nam = ViewBag.Nam ?? DateTime.Now.Year;

    // Styles variables
    var primaryGreenDark = "rgb(77, 102, 72)";
    var secondaryGreenLight = "rgb(130, 140, 110)";
    var darkBrown = "rgb(82, 60, 52)";
    var lightBeige = "rgb(220, 218, 201)";
    var successColor = "#1cc88a";

    // Check Role
    bool isUser = Session["Quyen"]?.ToString() == "User";
}

<style>
    /* (Your existing styles remain here...) */
    .h3.mb-0 i.fas { color: @primaryGreenDark !important; }
    .card.border-top-primary { border-top: 4px solid @primaryGreenDark !important; }
    .btn-primary { background-color: @primaryGreenDark !important; border-color: @primaryGreenDark !important; color: #fff !important; }
    .btn-primary:hover { background-color: @darkBrown !important; border-color: @darkBrown !important; }
    .text-warning { color: @primaryGreenDark !important; }
    .card-header h6.text-success { color: @darkBrown !important; }
    .alert-info { background-color: @lightBeige !important; border-color: @secondaryGreenLight !important; color: @darkBrown !important; }
</style>

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">
        <i class="fas fa-business-time mr-2"></i>
        @if (isUser)
        {<text>Tra cứu giờ tăng ca cá nhân</text> }
    else
    { <text>Quản lý giờ tăng ca (UC8)</text>}
    </h1>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">

        @if (ViewBag.ErrorMessage != null)
        {
            <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
                <i class="fas fa-exclamation-triangle mr-2"></i> @ViewBag.ErrorMessage
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        <div class="card card-plus shadow mb-4 border-top-primary">
            <div class="card-header py-3 bg-white border-bottom-0">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-filter"></i> Chọn thời gian
                </h6>
            </div>
            <div class="card-body">
                <form method="get" action="@Url.Action("XemGioTangCa")">
                    <div class="form-row align-items-end">

                        @if (isUser)
                        {
                            // HIDDEN INPUT FOR USER - No visible selection needed
                            <input type="hidden" name="maNV" value="@Session["MaNV"]" />
                        }
                        else
                        {
                            // DROPDOWN FOR ADMIN/HR
                            <div class="form-group col-md-5">
                                <label class="font-weight-bold text-gray-700 small">Nhân viên:</label>
                                @Html.DropDownList("maNV", (IEnumerable<SelectListItem>)ViewBag.DanhSachNhanVien, "-- Chọn nhân viên --", new { @class = "form-control custom-select" })
                            </div>
                        }

                        <div class="form-group col-md-@((isUser) ? "5" : "3")">
                            <label class="font-weight-bold text-gray-700 small">Tháng:</label>
                            <select name="thang" class="form-control custom-select">
                                @for (int i = 1; i <= 12; i++)
                                {
                                    <option value="@i" @(i == thang ? "selected" : "")>Tháng @i</option>
                                }
                            </select>
                        </div>

                        <div class="form-group col-md-@((isUser) ? "4" : "2")">
                            <label class="font-weight-bold text-gray-700 small">Năm:</label>
                            <select name="nam" class="form-control custom-select">
                                @for (int y = DateTime.Now.Year; y >= 2020; y--)
                                {
                                    <option value="@y" @(y == nam ? "selected" : "")>@y</option>
                                }
                            </select>
                        </div>

                        <div class="form-group col-md-@((isUser) ? "3" : "2")">
                            <button type="submit" class="btn btn-primary btn-block shadow-sm">
                                <i class="fas fa-search"></i> Xem
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        @if (ViewBag.TongGioTangCa != null)
        {
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-success">
                        <i class="fas fa-clipboard-check"></i> Kết quả tháng @thang/@nam
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Tổng giờ tăng ca
                                            </div>
                                            <div class="h3 mb-0 font-weight-bold text-gray-800">
                                                @ViewBag.TongGioTangCa <small class="text-muted" style="font-size: 0.6em">giờ</small>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Thành tiền dự kiến
                                            </div>
                                            <div class="h3 mb-0 font-weight-bold text-gray-800">
                                                @string.Format("{0:N0}", ViewBag.TienTangCa) <small class="text-muted" style="font-size: 0.6em">VNĐ</small>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-money-bill-wave fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info border-0 text-dark small mb-0">
                        <i class="fas fa-info-circle text-info mr-1"></i>
                        <strong>Công thức:</strong> Tiền tăng ca = (Tổng giờ tăng ca) × <strong>50,000 VNĐ</strong>
                    </div>
                </div>
            </div>
        }
        else if (Request.QueryString["thang"] != null)
        {
            // Only show "Not Found" if a search was actually performed (query string exists)
            <div class="text-center py-4">
                <i class="fas fa-search-minus fa-3x text-gray-300 mb-3"></i>
                <h6 class="text-gray-500">Không có dữ liệu tăng ca trong tháng @thang/@nam.</h6>
            </div>
        }

        <div class="card shadow mb-4">
            <a href="#collapseGuide" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="false">
                <h6 class="m-0 font-weight-bold text-secondary">
                    <i class="fas fa-question-circle"></i> Quy định tính toán
                </h6>
            </a>
            <div class="collapse" id="collapseGuide">
                <div class="card-body">
                    <p class="mb-2"><strong>Quy trình hệ thống xử lý:</strong></p>
                    <ol class="text-sm text-gray-700 pl-3">
                        <li class="mb-1">Hệ thống tổng hợp dữ liệu từ máy chấm công/bảng công hàng ngày.</li>
                        <li class="mb-1">Lọc dữ liệu theo tháng và năm bạn chọn.</li>
                        <li class="mb-1">Cộng dồn tất cả giờ làm thêm (OT) đã được duyệt.</li>
                        <li>Nhân tổng giờ với đơn giá 50,000 VNĐ/giờ để ra thành tiền dự kiến.</li>
                    </ol>
                </div>
            </div>
        </div>

    </div>
</div>